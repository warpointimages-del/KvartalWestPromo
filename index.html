<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–û–ó–´–ì–†–´–® –ü–†–ò–ó–û–í | WARPOINT</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="scroll-animate">
        <img src="pics/headerlogo.svg" alt="WARPOINT" class="logo-header">
        <div class="header-text">
            <h1>–†–û–ó–´–ì–†–´–® <span class="highlight">–ü–†–ò–ó–û–í</span></h1>
            <p class="subtitle">–£—á–∞—Å—Ç–≤—É–π –∏ –≤—ã–∏–≥—Ä–∞–π –∫—Ä—É—Ç—ã–µ –ø—Ä–∏–∑—ã!</p>
        </div>

        <div class="prizes-grid">
            <div class="prize-card">
                <img src="pics/ps5.webp" alt="PlayStation 5" class="prize-image">
                <h3 class="prize-place" style="color: #ffd700;">1 –ú–ï–°–¢–û</h3>
                <p class="prize-name">PlayStation 5</p>
            </div>
            <div class="prize-card">
                <img src="pics/vr.webp" alt="VR —à–ª–µ–º" class="prize-image">
                <h3 class="prize-place" style="color: #c0c0c0;">2 –ú–ï–°–¢–û</h3>
                <p class="prize-name">Oculus Quest 3S</p>
            </div>
            <div class="prize-card">
                <img src="pics/speaker.webp" alt="–ö–æ–ª–æ–Ω–∫–∞" class="prize-image">
                <h3 class="prize-place" style="color: #cd7f32;">3 –ú–ï–°–¢–û</h3>
                <p class="prize-name">–Ø–Ω–¥–µ–∫—Å –°—Ç–∞–Ω—Ü–∏—è –ú–∏–¥–∏</p>
            </div>
        </div>
    </header>

    <section class="registration scroll-animate">
        <h2>–ó–ê–ü–ò–°–¨ –ù–ê <span class="highlight">–£–ß–ê–°–¢–ò–ï</span></h2>
        
        <!-- –ö–∞—Å—Ç–æ–º–Ω–∞—è —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ -->
        <div class="custom-form-container">
            <form id="warpointForm" class="warpoint-form">
                <div class="form-field">
                    <label for="fullName" class="field-label">–§–ò–û *</label>
                    <input type="text" id="fullName" required class="warpoint-input" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                </div>

                <div class="form-field">
                    <label for="birthDate" class="field-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è *</label>
                    <input type="date" id="birthDate" required class="warpoint-input">
                </div>

                <div class="form-field">
                    <label for="phone" class="field-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                    <input type="tel" id="phone" required class="warpoint-input" placeholder="+7 (999) 999-99-99">
                </div>

                <button type="submit" class="warpoint-submit-btn">
                    <span class="btn-text">–£–ß–ê–°–¢–í–û–í–ê–¢–¨ –í –†–û–ó–´–ì–†–´–®–ï</span>
                </button>
            </form>
            
            <div id="message" class="message"></div>
        </div>
    </section>

    <footer class="scroll-animate">
        <img src="pics/logo.svg" alt="WARPOINT" class="logo-small">
        <p class="secondary">¬© 2025 –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</p>
    </footer>

    <script>
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.scroll-animate').forEach(el => {
            observer.observe(el);
        });

        // URL –≤–∞—à–µ–≥–æ Google Apps Script (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π)
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwEznqQZH39IO13Nlv8gtvlLnSyNiMa41qc-tTt62PmSXDYqXnkhWcfXEX_6bII9HM4/exec';

        class WarpointForm {
            constructor() {
                this.form = document.getElementById('warpointForm');
                this.messageDiv = document.getElementById('message');
                this.submitBtn = this.form.querySelector('.warpoint-submit-btn');
                
                this.init();
            }
            
            init() {
                this.form.addEventListener('submit', (e) => this.handleSubmit(e));
                
                // –ú–∞—Å–∫–∞ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                const phoneInput = document.getElementById('phone');
                phoneInput.addEventListener('input', (e) => this.formatPhone(e.target));
            }
            
            formatPhone(input) {
                let numbers = input.value.replace(/\D/g, '');
                
                if (numbers.startsWith('7') || numbers.startsWith('8')) {
                    numbers = '7' + numbers.substring(1);
                } else if (numbers.startsWith('9')) {
                    numbers = '7' + numbers;
                }
                
                if (numbers.length > 0) {
                    let formatted = '+7 ';
                    if (numbers.length > 1) {
                        formatted += '(' + numbers.substring(1, 4);
                    }
                    if (numbers.length >= 4) {
                        formatted += ') ' + numbers.substring(4, 7);
                    }
                    if (numbers.length >= 7) {
                        formatted += '-' + numbers.substring(7, 9);
                    }
                    if (numbers.length >= 9) {
                        formatted += '-' + numbers.substring(9, 11);
                    }
                    input.value = formatted;
                }
            }
            
            async handleSubmit(e) {
                e.preventDefault();
                
                const formData = {
                    fullName: document.getElementById('fullName').value.trim(),
                    birthDate: document.getElementById('birthDate').value,
                    phone: document.getElementById('phone').value.replace(/\D/g, '')
                };
                
                if (!this.validateData(formData)) {
                    return;
                }
                
                this.setLoading(true);
                
                try {
                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'text/plain;charset=utf-8',
                        },
                        body: JSON.stringify(formData)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showMessage('üéâ –í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ!', 'success');
                        this.form.reset();
                    } else {
                        this.showMessage('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', 'error');
                    }
                    
                } catch (error) {
                    console.error('Error:', error);
                    this.showMessage('üö´ –û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', 'error');
                } finally {
                    this.setLoading(false);
                }
            }
            
            validateData(data) {
                if (data.fullName.length < 2) {
                    this.showMessage('‚úèÔ∏è –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –§–ò–û', 'error');
                    return false;
                }
                
                if (!data.birthDate) {
                    this.showMessage('üìÖ –í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è', 'error');
                    return false;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞
                const birthDate = new Date(data.birthDate);
                const today = new Date();
                const age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                if (age < 13) {
                    this.showMessage('üîû –î–ª—è —É—á–∞—Å—Ç–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—ã—Ç—å —Å—Ç–∞—Ä—à–µ 13 –ª–µ—Ç', 'error');
                    return false;
                }
                
                if (data.phone.length !== 11) {
                    this.showMessage('üì± –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', 'error');
                    return false;
                }
                
                return true;
            }
            
            setLoading(loading) {
                this.submitBtn.disabled = loading;
                const btnText = this.submitBtn.querySelector('.btn-text');
                btnText.textContent = loading ? '‚è≥ –û–¢–ü–†–ê–í–ö–ê...' : '–£–ß–ê–°–¢–í–û–í–ê–¢–¨ –í –†–û–ó–´–ì–†–´–®–ï';
            }
            
            showMessage(text, type) {
                this.messageDiv.textContent = text;
                this.messageDiv.className = `message ${type}`;
                
                setTimeout(() => {
                    this.messageDiv.textContent = '';
                    this.messageDiv.className = 'message';
                }, 5000);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
        document.addEventListener('DOMContentLoaded', function() {
            new WarpointForm();
        });
    </script>
</body>
</html>
