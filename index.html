<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>РОЗЫГРЫШ ПРИЗОВ | WARPOINT</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="scroll-animate">
        <img src="pics/headerlogo.svg" alt="WARPOINT" class="logo-header">
        <div class="header-text">
            <h1>РОЗЫГРЫШ <span class="highlight">ПРИЗОВ</span></h1>
            <p class="subtitle">Участвуй и выиграй крутые призы!</p>
        </div>

        <div class="prizes-grid">
            <div class="prize-card">
                <img src="pics/ps5.webp" alt="PlayStation 5" class="prize-image">
                <h3 class="prize-place" style="color: #ffd700;">1 МЕСТО</h3>
                <p class="prize-name">PlayStation 5</p>
            </div>
            <div class="prize-card">
                <img src="pics/vr.webp" alt="VR шлем" class="prize-image">
                <h3 class="prize-place" style="color: #c0c0c0;">2 МЕСТО</h3>
                <p class="prize-name">Oculus Quest 3S</p>
            </div>
            <div class="prize-card">
                <img src="pics/speaker.webp" alt="Колонка" class="prize-image">
                <h3 class="prize-place" style="color: #cd7f32;">3 МЕСТО</h3>
                <p class="prize-name">Яндекс Станция Миди</p>
            </div>
        </div>
    </header>

    <section class="registration scroll-animate">
        <h2>ЗАПИСЬ НА <span class="highlight">УЧАСТИЕ</span></h2>
        
        <!-- Кастомная стилизованная форма -->
        <div class="custom-form-container">
            <form id="warpointForm" class="warpoint-form">
                <div class="form-field">
                    <label for="fullName" class="field-label">ФИО *</label>
                    <input type="text" id="fullName" required class="warpoint-input" placeholder="Фамилия Имя Отчество">
                </div>

                <div class="form-field">
                    <label for="birthDate" class="field-label">Дата рождения *</label>
                    <input type="date" id="birthDate" required class="warpoint-input">
                </div>

                <div class="form-field">
                    <label for="phone" class="field-label">Телефон *</label>
                    <input type="tel" id="phone" required class="warpoint-input" placeholder="+7 (999) 999-99-99">
                </div>

                <button type="submit" class="warpoint-submit-btn">
                    <span class="btn-text">УЧАСТВОВАТЬ В РОЗЫГРЫШЕ</span>
                </button>
            </form>
            
            <div id="message" class="message"></div>
        </div>
    </section>

    <!-- Скрытая форма для отправки в Google Forms -->
    <div style="display: none;">
        <form id="googleForm" action="https://docs.google.com/forms/d/e/1FAIpQLSfT5rz1pJCS1tlPkT26-gtJ_BIK92m65oivdSuWZHBNtW4jKA/formResponse" method="POST" target="_blank">
            <input type="text" name="entry.919636716" id="googleName">
            <input type="text" name="entry.743560137" id="googleDate">
            <input type="text" name="entry.1371029049" id="googlePhone">
            <input type="hidden" name="fvv" value="1">
            <input type="hidden" name="fbzx" value="1725711925197514858">
        </form>
    </div>

    <footer class="scroll-animate">
        <img src="pics/logo.svg" alt="WARPOINT" class="logo-small">
        <p class="secondary">© 2025 Все права защищены</p>
    </footer>

    <script>
        // Анимация при скролле
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.scroll-animate').forEach(el => {
            observer.observe(el);
        });

        class WarpointForm {
            constructor() {
                this.form = document.getElementById('warpointForm');
                this.messageDiv = document.getElementById('message');
                this.submitBtn = this.form.querySelector('.warpoint-submit-btn');
                this.googleForm = document.getElementById('googleForm');
                
                this.init();
            }
            
            init() {
                this.form.addEventListener('submit', (e) => this.handleSubmit(e));
                
                // Маска для телефона
                const phoneInput = document.getElementById('phone');
                phoneInput.addEventListener('input', (e) => this.formatPhone(e.target));
            }
            
            formatPhone(input) {
                let numbers = input.value.replace(/\D/g, '');
                
                if (numbers.startsWith('7') || numbers.startsWith('8')) {
                    numbers = '7' + numbers.substring(1);
                } else if (numbers.startsWith('9')) {
                    numbers = '7' + numbers;
                }
                
                if (numbers.length > 0) {
                    let formatted = '+7 ';
                    if (numbers.length > 1) {
                        formatted += '(' + numbers.substring(1, 4);
                    }
                    if (numbers.length >= 4) {
                        formatted += ') ' + numbers.substring(4, 7);
                    }
                    if (numbers.length >= 7) {
                        formatted += '-' + numbers.substring(7, 9);
                    }
                    if (numbers.length >= 9) {
                        formatted += '-' + numbers.substring(9, 11);
                    }
                    input.value = formatted;
                }
            }
            
            async handleSubmit(e) {
                e.preventDefault();
                
                const formData = {
                    fullName: document.getElementById('fullName').value.trim(),
                    birthDate: document.getElementById('birthDate').value,
                    phone: document.getElementById('phone').value.replace(/\D/g, '')
                };
                
                if (!this.validateData(formData)) {
                    return;
                }
                
                this.setLoading(true);
                
                try {
                    // Отправляем данные в Google Forms
                    document.getElementById('googleName').value = formData.fullName;
                    document.getElementById('googleDate').value = formData.birthDate;
                    document.getElementById('googlePhone').value = formData.phone;
                    
                    // Создаем iframe для отправки
                    this.submitToGoogleForms();
                    
                    this.showMessage('ВЫ УСПЕШНО ЗАРЕГИСТРИРОВАНЫ В РОЗЫГРЫШЕ!', 'success');
                    this.form.reset();
                    
                } catch (error) {
                    console.error('Error:', error);
                    this.showMessage('ОШИБКА ОТПРАВКИ. ПОПРОБУЙТЕ ЕЩЁ РАЗ.', 'error');
                } finally {
                    this.setLoading(false);
                }
            }
            
            submitToGoogleForms() {
                // Создаем временный iframe для отправки формы
                const tempIframe = document.createElement('iframe');
                tempIframe.style.display = 'none';
                tempIframe.name = 'temp-iframe';
                document.body.appendChild(tempIframe);
                
                this.googleForm.target = 'temp-iframe';
                this.googleForm.submit();
                
                // Удаляем iframe через секунду
                setTimeout(() => {
                    document.body.removeChild(tempIframe);
                }, 1000);
            }
            
            validateData(data) {
                if (data.fullName.length < 2) {
                    this.showMessage('ВВЕДИТЕ КОРРЕКТНОЕ ФИО', 'error');
                    return false;
                }
                
                if (!data.birthDate) {
                    this.showMessage('ВВЕДИТЕ ДАТУ РОЖДЕНИЯ', 'error');
                    return false;
                }
                
                // Проверка возраста
                const birthDate = new Date(data.birthDate);
                const today = new Date();
                const age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                if (age < 13) {
                    this.showMessage('ДЛЯ УЧАСТИЯ НЕОБХОДИМО БЫТЬ СТАРШЕ 13 ЛЕТ', 'error');
                    return false;
                }
                
                if (data.phone.length !== 11) {
                    this.showMessage('ВВЕДИТЕ КОРРЕКТНЫЙ НОМЕР ТЕЛЕФОНА', 'error');
                    return false;
                }
                
                return true;
            }
            
            setLoading(loading) {
                this.submitBtn.disabled = loading;
                const btnText = this.submitBtn.querySelector('.btn-text');
                btnText.textContent = loading ? 'ОТПРАВКА...' : 'УЧАСТВОВАТЬ В РОЗЫГРЫШЕ';
            }
            
            showMessage(text, type) {
                this.messageDiv.textContent = text;
                this.messageDiv.className = `message ${type}`;
                
                setTimeout(() => {
                    this.messageDiv.textContent = '';
                    this.messageDiv.className = 'message';
                }, 5000);
            }
        }

        // Инициализация формы
        document.addEventListener('DOMContentLoaded', function() {
            new WarpointForm();
        });
    </script>
</body>
</html>
